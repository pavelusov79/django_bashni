{% extends 'main/base.html' %}
{% load static %}
{% load view_price %}

{% block title %}Избранное{% endblock title %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-12 pb-2 pl-0 mb-5" style="border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb" style="background: none;">
              <li class="breadcrumb-item fr-item"><a class="font-weight-bold gray" href="/">Главная</a></li>
              <li class="breadcrumb-item fr-item">
                  {% if page %}
                  <a class="font-weight-bold gray" href="{{ page }}">Жилые комплексы {{ object.city.city_name }}</a>
                  {% else %}
                  <a class="font-weight-bold gray" href="#" onclick="javascript:history.go(-1); return false;">Вернуться назад</a>
                  {% endif %}
              </li>
              <li class="breadcrumb-item fr-item active font-weight-bold" aria-current="page">Избранное</li>
            </ol>
          </nav>
          <h1 class="gray">Избранное</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <ul class="nav type_object mb-4 pb-4" style="border-bottom: none;">
                <li value="fl" class="active gray mr-3">Квартиры</li>
                <li value="zhk" class="gray mr-3">Новостройки</li>
                <li value="parking" class="gray mr-3">Машиноместа</li>
                <li value="store" class="gray mr-3">Кладовые</li>
            </ul>
        </div>
        <div class="{% if request.session.fav_zhk or request.session.fav_fl %}col-12{% else %}col-12 col-sm-10{% endif %}">
            {% if request.session.fav_fl %}
                <div class="block-1" style="display: flex; flex-wrap: wrap; clear: left;">
                    {% for id in request.session.fav_fl %}
                        {% for item in fl %}
                            {% if id == item.id %}
                                <div class="col-6 col-md-4 col-xl-3 res">
                                    <div class="card mb-3" style="border: none;">
                                        <a href="{% url 'flat_detail' item.fk_property.city.city_slug item.pk item.slug %}">
                                           {% if item.fl_drawing %}
                                           <img class="card-img-top py-2" src="/media/{{ item.fl_drawing }}" alt="img" style="height: 11rem; object-fit: contain; border: 1px solid #ccc; border-radius: 0.5rem;">
                                           {% else %}
                                           <p class="h5" style="height: 11rem; object-fit: contain;">Изображение планировки отсутствует</p>
                                           {% endif %}
                                        </a>
                                        <p class="heart heart-fl">
                                            <span>
                                                <i id="{{ item.id }}_fl" data-url="{{ request.path }}" class="fa fa-heart delete_fav fl" aria-hidden="true" style="color: #55B50C;"></i>
                                            </span>
                                        </p>
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <h6 class="card-title gray">{% if item.fl_price %}{{ item.fl_price|price }} &#8381;{% else %}стоимость не указана{% endif %}</h6>
                                                <p style="display: inline-block;">{% if item.fl_decor == 'Да' %}<img src="{% static '/img/otdelka.png' %}" alt="img" title="Квартира с отделкой">
                                                    {% elif item.fl_decor == 'Нет' %}<img src="{% static '/img/net_otdelki.png' %}" alt="img" title="Квартира без отделки">
                                                    {% elif item.fl_decor == 'whitebox' %}<img src="{% static '/img/whitebox.png' %}" alt="img" title="Квартира с отделкой whitebox">
                                                    {% elif item.fl_decor == 'zak' %}<img src="{% static '/img/zak.png' %}" alt="img" title="Отделкка по желанию заказчика">{% endif %}</p>
                                            </div>
                                            <p class="d-flex justify-content-between gray" style="height: 1.5rem;">
                                                <span>{% if item.fl_type == 'C' %}Студия{% else %}{{ item.fl_type }}-х комн{% endif %}</span><span class="dot_html">&middot;</span><span>{{ item.fl_sq }} м2</span><span class="dot_html">&middot;</span><span>{% if item.fk_property.name == 'More (Море)' or item.fk_property.name == 'Premium park (Премиум парк)' %}&mdash; этаж{% else %}{{ item.floor }} этаж{% endif %}</span>
                                            </p>
                                            <p class="gray"><span class="font-weight-bold">{{ item.fk_property.name }}</span> {{ item.fk_building.num_dom }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                    <div class="col-6 col-md-4 col-xl-3 save_favorites">
                        <p class="pt-4 text-center h5">Сохранить избранное?</p>
                        <p class="py-3 px-3 text-center">Зарегистрируйтесь или авторизуйтесь для того, чтобы сохранить избранное и получить доступ к другим сервисам.</p>
                        <p class="my-3 text-center"><a class="btn btn-outline-success add_favorites" href="{% url 'authapp:register' %}" style="width: 80%;">Регистрация</a></p>
                        <p class="text-center"><a class="btn btn-outline-success add_favorites" href="{% url 'authapp:login' %}?next={{ request.path }}" style="width: 80%;">Авторизация</a></p>
                    </div>
                </div>
            {% else %}
                <div class="block-1 heart_back">
                    <div>
                        <h4 class="mt-4 gray">Пока здесь пусто...</h4>
                        <h4 class="mt-3 mb-5 gray">Воспользуйтесь нашим <a class="a_fav" href="{% url 'sale' city='vladivostok' %}">поиском</a> и найдите, то что по душе.</h4>
                    </div>
                </div>
            {% endif %}
            <div class="block-2">
                <h4 class="mt-4 mb-5 gray">Пока здесь пусто...</h4>
            </div>
            <div class="block-4">
                <h4 class="mt-4 mb-5 gray">Пока здесь пусто...</h4>
            </div>
            {% if request.session.fav_zhk %}
                <div class="block-5" style="clear: left;">
                    {% for id in request.session.fav_zhk %}
                        {% for item in zhk %}
                            {% if id == item.id %}
                                <div class="col-6 col-md-4 col-xl-3 res">
                                    <div class="card" style="border: none">
                                       <a href="{% url 'property_detail' item.city.city_slug item.pk item.slug %}">
                                           <img class="card-img-top" src="/media/{{ item.buildings_set.first.small_img }}" alt="img" style="height: 10rem; border-radius: 5px">
                                       </a>
                                       <p class="heart">
                                            <span>
                                                <i id="{{ item.id }}_zhk" data-url="{{ request.path }}" class="fa fa-heart delete_fav zhk" aria-hidden="true" style="color: #55B50C;"></i>
                                            </span>
                                        </p>
                                        <div class="card-body pb-0" style="position: relative; bottom: 2rem;">
                                            <div class="d-flex justify-content-between">
                                                <p><span><i class="fa fa-star" aria-hidden="true" style="color: #55B50C;"></i>
                                                    {% if item.rate.first.get_rating %}{{ item.rate.first.get_rating }}{% else %}0,0{% endif %}
                                                    </span>
                                                    <span class="ml-3"><i class="fa fa-comment-o" aria-hidden="true" style="color: #55B50C;"></i> {{ item.testimonials.all|length }}</span>
                                                </p>
                                                <p class="badge badge-pill badge-success">{{ item.buildings_set.first.get_build_stage_display }}</p>
                                            </div>
                                            <h4 class="card-title"><a href="{% url 'property_detail' item.city.city_slug item.pk item.slug %}" style="color: #55B50C;">{{ item.name|truncatewords:20 }}</a></h4>
                                            <p class="gray mb-1">{% if item.district %}{{ item.district }} р-н{% else %}район не указан{% endif %}</p>
                                            <p class="small gray mb-1">Срок сдачи: {{ item.buildings_set.first.operation_term }}</p>
                                            <p class="gray">Стоимость 1 м2: {% if item.buildings_set.first.middle_price %}{{ item.buildings_set.first.middle_price|price }} &#8381{% else %} &mdash;{% endif %}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                    <div class="col-6 col-md-4 col-xl-3 save_favorites">
                        <p class="pt-4 text-center h5">Сохранить избранное?</p>
                        <p class="py-3 px-3 text-center">Зарегистрируйтесь или авторизуйтесь для того, чтобы сохранить избранное и получить доступ к другим сервисам.</p>
                        <p class="my-3 text-center"><a class="btn btn-outline-success add_favorites" href="{% url 'authapp:register' %}" style="width: 80%;">Регистрация</a></p>
                        <p class="text-center"><a class="btn btn-outline-success add_favorites" href="{% url 'authapp:login' %}?next={{ request.path }}" style="width: 80%;">Авторизация</a></p>
                    </div>
                </div>
            {% else %}
                <div class="block-5 heart_back">
                    <div>
                       <h4 class="mt-4 gray">Пока здесь пусто...</h4>
                        <h4 class="mt-3 mb-5 gray">Воспользуйтесь нашим <a class="a_fav" href="{% url 'property' city='vladivostok' %}">поиском</a> и найдите, то что по душе.</h4>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock content %}