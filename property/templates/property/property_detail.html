{% extends 'main/base.html' %}
{% load static %}
{% load view_price %}

{% block title %}{{ object.name }}{% endblock title %}

{% block content %}
<div class="modal" id="modal_form_request" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Записаться на просмотр объекта</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <form class="request_form" action="" method="post">
            {% csrf_token %}
            {{ request_form.as_p }}
            <button class="btn btn-primary" type="submit">отправить запрос</button>
          </form>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="m_{{object.id}}" tabindex="-1" role="dialog">
  <div class="modal_add_info modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Документация</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <a href="{{ object.buildings_set.first.pr_decl_link }}" class="d-flex justify-content-between gray mb-2">
          <p>Проектная декларация</p>
          <p>№{{ object.buildings_set.first.pr_declaration }}</p>
        </a>
        {% for doc in object.buildings_set.first.documents.all %}
          <a href="{{ doc.doc_link }}" class="d-flex justify-content-between gray mb-2">
            <p style="width: 70%;">{{ doc.doc_name }}</p>
            <p>{{ doc.doc_date|date:"d E Y" }}</p>
          </a>
        {% endfor %}  
      </div>
    </div>
  </div>
</div>

<div class="modal" id="testimonial_zhk" tabindex="-1" role="dialog">
  <div class="modal_add_info modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="gray">Оставьте ваше мнение о ЖК</h2>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h4 class="gray mb-4">Оцените жилой комплекс</h4>
          <form id="rating_form" action="" method="post">
            {% csrf_token %}
            <span class="rating">
              {% for k,v in star_form.fields.star.choices %}
                <input type="radio" name="star" id="rating{{ v }}" value="{{ k }}">
                <label class="star" for="rating{{ v }}"></label>
              {% endfor %}
            </span>
          </form>
        <div class="my-4">
          <h4 class="gray mb-4">Оставьте отзыв</h4>
          {% if request.user.is_authenticated %}
            <form id="send_testimonial" action="{% url 'property_detail' object.city.city_slug object.pk object.slug %}" method="post">
              {% csrf_token %}
              {{ form.as_p }}
              <button class="btn btn-success my-4" style="width: 12rem; border-radius: 5px;">Отправить</button>
            </form>
          {% else %}
            <p class="gray">Анонимные пользователи не могут оставлять комментарии.</p>
            <p class="gray">Просим Вас <a href="{% url 'authapp:login' %}?next={{ request.path }}">авторизоваться</a> или
                <a href="{% url 'authapp:register' %}">зарегистрироваться</a>.
            </p>
          {% endif %}
        </div>
        <h2 class="mb-3 gray">Отзывы пользователей</h2>
        {% if testimonials %}
          {% for item in testimonials|slice:":6" %}
          <p class="font-italic gray"><span>{{ item.date|date:'d.m.Y' }}</span><span class="ml-5 gray">от пользователя: {{ item.user.first_name }}</span></p>
          <div class="font-italic gray">{{ item.testimonial|linebreaks }}</div>
          <hr class="gray mb-3">
          {% endfor %}
        {% else %}
          <h4 class="my-3 mb-5 gray font-style-italic">Отзывов о ЖК еще не оставили</h4>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="modal" id="add_{{object.id}}" tabindex="-1" role="dialog">
  <div class="modal_add_info modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="navbar nav_modal">
          {% if object.territory_desc %}<a href="#territory_desc" style="text-decoration: none;" class="btn btn-success mod_btn nav-item active mr-4">Благоустройство</a>{% endif %}
          {% if object.infr_desc %}<a href="#infr_desc" style="text-decoration: none;" class="btn btn-success mod_btn nav-item mr-4">Инфраструктура</a>{% endif %}
          {% if object.work_desc %}<a href="#work_desc" style="text-decoration: none;" class="btn btn-success mod_btn nav-item">Перечень работ</a>{% endif %}
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% if object.territory_desc %}
        <h2 id="territory_desc" class="gray my-3">Благоустройство</h2>
        {{ object.territory_desc|safe }}
        {% endif %}
        {% if object.infr_desc %}
        <h2 id="infr_desc" class="gray my-3">Инфраструктура</h2>
        {{ object.infr_desc|safe }}
        {% endif %}
        {% if object.work_desc %}
        <h2 id="work_desc" class="gray my-3">Перечень работ</h2>
        {{ object.work_desc|safe }}
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% for item in object.buildings_set.first.build_months.all|slice:":3" %}
  <div class="modal" id="modal_{{item.id}}" tabindex="-1" role="dialog">
    <div class="modal-photos modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5>{{ item.build_month }}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="carouselControls_{{item.id}}" class="carousel slide" data-ride="carousel" data-interval="false">
            <div class="carousel-inner build-photo" style="height: 30rem;">
              <div class="carousel-item active">
                <img class="d-block w-100 build-photo" src="/media/{{ item.build_photos.first.build_img }}" alt="img" style="height: 30rem; object-fit: cover;">
              </div>
              {% for img in item.build_photos.all|slice:"1:4" %}
              <div class="carousel-item">
                <img class="d-block w-100 build-photo" src="/media/{{ img.build_img }}" alt="img" style="height: 30rem; object-fit: cover;">
              </div>
              {% endfor %}
              <a class="carousel-control-prev" href="#carouselControls_{{item.id}}" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#carouselControls_{{item.id}}" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endfor %}

<div class="container-fluid">
  <div class="row justify-content-center mt-3 nav-tar">
    <div class="col-12 pb-3 d-flex align-items-center justify-content-around second-top">
      <ul class="nav">
        <li class="nav-item"><a class="nav-link tar" href="#description" style="color: #8D8D8D;">Описание</a></li>
        <li class="nav-item"><a class="nav-link tar" href="#disposal" style="color: #8D8D8D;">Район</a></li>
        <li class="nav-item"><a class="nav-link tar" href="#building" style="color: #8D8D8D;">Ход строительства</a></li>
        <li class="nav-item"><a class="nav-link tar" href="#documents" style="color: #8D8D8D;">Документация</a></li>
        {% if object.buid_video %}<li class="nav-item"><a class="nav-link tar" href="#video" style="color: #8D8D8D;">Видеонаблюдение<span class="ml-2"><img src="{% static 'img/live.png' %}" alt="live" style="height: 1.2rem;"></span></a></li>{% endif %}
      </ul>
      <a  class="btn btn-success px-3 py-1" style="border-radius: 10px;" role="button" href="{% url 'sale' object.city.city_slug %}?zhk={{ object.name }}">Выбрать квартиру</a>
    </div>
  </div>
  <div class="row">
    <div class="col-12 px-0">
      <div id="carouselControls" class="carousel slide" data-ride="carousel" data-interval="false">
        <div class="carousel-inner property-photo" style="height: 30rem;">
          <div class="carousel-item active">
            <img class="d-block w-100 property-photo" src="/media/{{ object.buildings_set.first.main_photos.first.main_img }}" alt="img" style="height: 30rem; object-fit: cover;">
          </div>
          {% for img in object.buildings_set.first.main_photos.all|slice:"1:5" %}
          <div class="carousel-item">
            <img class="d-block w-100 property-photo" src="/media/{{ img.main_img }}" alt="img" style="height: 30rem; object-fit: cover;">
          </div>
          {% endfor %}
          <a class="carousel-control-prev" href="#carouselControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb br ml-5">
      <li class="breadcrumb-item br-item"><a class="font-weight-bold" href="/">Главная</a></li>
      <li class="breadcrumb-item br-item">
          {% if page %}
          <a class="font-weight-bold" href="{{ page }}">Жилые комплексы {{ object.city.city_name }}</a>
          {% else %}
          <a class="font-weight-bold" href="#" onclick="javascript:history.go(-1); return false;">Назад к результатам поиска</a>
          {% endif %}
      </li>
      <li class="breadcrumb-item br-item active font-weight-bold" aria-current="page">{{ object.name}} ({{ object.city.city_name }})</li>
    </ol>
  </nav>
  <button id="btn-testimon" class="btn btn-outline-secondary btn-lg ml-5" data-toggle="modal" data-target="#testimonial_zhk">Отзывы <i class="fa fa-star" aria-hidden="true"></i> {{ object.mid_rating }}</button>
  <div class="row justify-content-center" style="position: relative; bottom: 5rem; border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
    <div class="col-6 col-md-3 text-center">
      <p class="mb-0" style="color: #8D8D8D;">Жилой комплекс</p>
      <h1 style="color: #55B50C;">{{ object.name }}</h1>
    </div>
    <div class="col-6 col-md-3 text-center">
      <h2 class="mb-1" style="color: #55B50C;">{% if object.buildings_set.first.middle_price %}от {{ object.buildings_set.first.middle_price|price }} &#8381;</h2>{% else %} &mdash;{% endif %}
      <p style="color: #8D8D8D;">Средняя цена за 1 м2</p>
    </div>
    <div class="col-6 col-md-3 text-center">
      <h2 class="mb-0" style="color: #8D8D8D;">{% if object.buildings_set.first.operation_term %}{{ object.buildings_set.first.operation_term }}</h2>{% else %} &mdash;{% endif %}
      <p style="color: #8D8D8D;">Ближайший ввод в эксплуатацию</p>
    </div>
    <div class="col-6 col-md-3">
      <p class="mb-0">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.29634 1.55L4.8943 10.6196C5.0478 11.0107 5.68635 11 5.82756 10.6036L7.27657 6.49999C7.29844 6.43291 7.33994 6.37195 7.397 6.3231C7.45405 6.27426 7.5247 6.23922 7.60199 6.22142L12.299 4.95713C12.7533 4.83392 12.7656 4.27678 12.3174 4.14285L1.92261 1.00357C1.83527 0.976787 1.74104 0.972085 1.65077 0.990004C1.56051 1.00792 1.47788 1.04774 1.41242 1.10485C1.34696 1.16196 1.30133 1.23406 1.2808 1.31281C1.26026 1.39157 1.26565 1.47379 1.29634 1.55V1.55Z" stroke="#55B50C" stroke-width="1.52381" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span id="addr" class="small" style="color: #8D8D8D;">{{ object.buildings_set.first.addr }}</span>
      </p>
      <p class="small" style="color: #8D8D8D;">Застройщик: <span>{{ object.buildings_set.first.main_contractor }}</span></p>
    </div>
  </div>
  <div class="row mb-4" style="position: relative; bottom: 3rem;">
    <div class="col-6 col-md-3 px-5">
      <p class='gray pl-3'>Укажите кол-во комнат</p>
      <ul name="flat_t" id="flat_tp" class="nav type_fl d-flex justify-content-around gray">
        <li value="C">Студия</li>
        <li value="1">1</li>
        <li value="2">2</li>
        <li value="3">3</li>
        <li value="4">4</li>
        <li value="5">5</li>
      </ul>
    </div>
    <div class="col-6 col-md-3 px-5">
      <p class='gray'>Задайте стоимость, млн. &#8381;</p>
      <div class="d-flex justify-content-between">
        <p class="mb-0 gray">от <span id="sl3SliderMinValue">5</span> млн</p>
        <p class="mb-0 gray">до <span id="sl3SliderMaxValue">20</span> млн</p>
      </div>
      <p><input id="sl3" data-slider-id="sl3Slider" type="text" name="price" data-slider-min="5" data-slider-max="20" data-slider-step="1" data-slider-value="[5, 20]"></p>
    </div>
    <div class="col-6 col-md-3 px-5">
      <p class='gray'>Укажите дату заселения</p>
      <select name="finish_date">
        {% for item in dates %}
            <option value="{{ item.operation_term }}">{{ item.operation_term }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-6 col-md-3 get_zhk_id" data-id="{{ object.name }}">
      <a href="{% url 'sale' object.city.city_slug  %}?zhk={{ object.name }}&flat_type=&price=&date=" class="btn btn-success px-4 py-2 mt-3 link_sale" style="border-radius: 10px;">Выбрать квартиру</a>
    </div>
  </div>
</div>
<div class="container px-sm-0" style="position: relative; bottom: 3rem;">
  <h2 id="description" class="gray font-weight-bold mb-3">О жилом комплексе</h2>
  <div class="row mb-4 justify-content-center">
    <div class="col-11 col-md-7 gray">
      {% if object.short_desc %}
        {{ object.short_desc|safe }}
      {% else %}
        {% lorem 2 p random %}
      {% endif %}
      <button id="obj_about" class="btn btn-outline-secondary gray mb-4 pl-4 but-gray mt-3" data-toggle="modal" data-target="#add_{{ object.id }}">Подробнее 
        <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.8125 6.375L8.5 11.6875L3.1875 6.375" stroke="#8D8D8D" stroke-width="1.0625" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <div class="d-flex justify-content-between flex-wrap">
        {% for item in object.facilities.all|slice:":6" %}
          <div class="col-11 col-sm-6 d-flex pl-0 mb-3">
            <p>{{ item.vector|safe }}</p><p class="gray ml-2">{{ item.name }}</p>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="col-6 col-md-5">
      {% if object.video %}
        <iframe class="property-frame" src="{{ object.video }}" allow="autoplay" frameborder="0" allowfullscreen style="width: 100%; height: 16.5rem;"></iframe>
      {% else %}
      <iframe id="player" class="property-frame" src="https://www.youtube.com/embed/d0rSVCAjEn8?autoplay=1&mute=1" allow="autoplay" frameborder="0" allowfullscreen style="width: 100%; height: 16.5rem;"></iframe>
        <!--img src="/media/build.jpg" style="height: 19rem;"-->
      {% endif %}
    </div>
  </div>
  {% if object.has_scraper %}
    <h2 class="gray font-weight-bold mb-3 mt-3">Цены на квартиры</h2>
    <div class="row justify-content-center mb-5 fl-results">
      <div class="col-12 col-sm-6 left-block" style="border: 1px solid #C4C4C4; height: 23.7rem; border-radius: 0.6rem;">
        <div class="d-flex justify-content-between">
          <span class='gray mt-2'>Подобрать квартиру</span>
          <ul name="flat_type" class="nav t_fl d-flex gray mt-2" style="width: 50%;" zhk-id="{{ object.id }}" url-d="{% url 'sale' object.city.city_slug %}">
            <!--li value="C">Студия</li>
            <li class="active" value="1">1</li>
            <li value="2">2</li>
            <li value="3">3</li>
            <li value="4">4</li>
            <li value="5">5</li-->
            {% for item in fil_flats %}
            <li class="mr-4 {% if item.fl_type == '1' %}active{% endif %}" value="{{ item.fl_type }}">{% if item.fl_type == 'C' %}Студия{% else %}{{ item.fl_type }}{% endif %}</li>
            {% endfor %}
          </ul>
        </div>
        <p class="gray my-3">Доступные планировки</p>
        <div class="d-flex plan" style="height: 8rem; cursor: pointer">
          {% if flats_d %}
            {% for f in flats_d|slice:":4" %}
              <div class="d-flex mr-3 flex-column fl_item align-items-center {% if f.fl_price == flats_d.0.fl_price %}div-active{% endif %}">
                {% if f.fl_drawing %}<img class=" mt-2 mx-3" style="width: 4rem; height: 5rem; object-fit:contain;" src="/media/{{ f.fl_drawing }}" alt="fl_drawing">{% else %}<p style="height: 5rem;">&mdash;</p>{% endif %}
                <p class="gray my-2 mr-4 fl_item_sq">{{ f.fl_sq }} м2</p>
              </div>
            {% endfor %}
          {% else %}
            <p class="gray my-4">Квартиры выбранного типа в данном жилом комплексе отсутствуют.</p>
          {% endif %}
        </div>
        {% if flats_d %}
          <hr class="gray my-3">
          <p class="gray mt-4 pp">Стоимость <span style="color: #55B50C !important;" class="ml-3 font-weight-bold fl_pr">от {{ current_price|price }} &#8381;</span></p>
          <a href="{% url 'sale' object.city.city_slug %}?zhk={{ object.name }}&flat_type=1" class="btn btn-success w-100 mt-4 go_sale" style="border-radius: 0.7rem;">Перейти в квартирографию</a>
        {% endif %}
      </div>
      <div class="col-12 col-sm-6 big-img text-center">
        <img  class="" src="{% if flats_d.0.fl_drawing %}/media/{{ flats_d.0.fl_drawing }}{% endif %}" alt="drawing" style="max-height: 23.7rem; max-width: 70%;">
      </div>
    </div>
  {% endif %}
  <h2 class="gray font-weight-bold mb-3 mt-3">Генплан проекта</h2>
  {% if object.gen_plan %}
    <div class="row mb-5 justify-content-center">
      <div class="col-11 col-sm-12">
        <img src="/media/{{ object.gen_plan }}" alt="gen_plan" style="width: 100%; object-fit: contain;">
      </div>
    </div>
  {% endif %}
  <h2 id="disposal" class="gray font-weight-bold mb-3 mt-3">Расположение и инфраструктура</h2>
  <div class="row mb-5 justify-content-center">
    <div id="map" style="height: 400px" class="col-11 col-sm-12"></div>
  </div>
  <div class="row justify-content-center">
    <div class="col-11 col-sm-12">
      {% if object.zhk_img %}
        <a class="request_for_view" href="#" data-toggle="modal" data-target="#modal_form_request">
          <img  class="img-record" src="/media/{{ object.zhk_img }}" alt="img" 
          style="height: 19rem; width: 100%; object-fit: cover;">
        </a>
      <h4 class="img_text" style="max-width: 85%;">Записаться на бесплатный просмотр объекта</h4>
      {% endif %}
    </div>
  </div>
  <h2 class="gray font-weight-bold mb-3">Расчет ипотеки</h2>
  <div class="row ipot mb-5 justify-content-center">
    <div class="col-10 col-sm-6 ipoteka-calc">
      <form  class="ipoteka_calc_form" method="post">
        {% csrf_token %}
        <div class="d-flex mt-4 justify-content-around">
          <div class="div1 green act"></div>
          <div class="div2 green"></div>
        </div>
        <p class="ml-4 mt-2 text-step">Шаг 1 из 2</p>
        <div class="step1 ml-4 step1-1">
          <h4 class="mt-2 mb-3">Укажите цену жилья</h4>
          <p class="t1 small mb-sm-4">Стоимость недвижимости</p>
          <p class="" style="width: 90%; margin-top: 1.7rem;"><input id="calc1" name="calc1" data-slider-id="calc1Slider" type="text" data-slider-min="4000000"
            data-slider-max="20000000" data-slider-step="50000" data-slider-value="6500000"></p>
          <p class="t1 small mb-sm-4">Первоначальный взнос</p>
          <p class="" style="width: 90%; margin-top: 1.7rem;"><input id="calc2" name="calc2" data-slider-id="calc2Slider" type="text" data-slider-min="500000"
            data-slider-max="2500000" data-slider-step="10000" data-slider-value="950000"></p>
        </div>
        <div class="step2 step2-2">
          <h4 class="mt-2 mb-4 ml-4">Укажите ваши данные</h4>
          <p class="text-center mb-0"><input type="text" class="ipoteka-text ipoteka-text-1 py-2 pl-3" name="fio" placeholder="ФИО"></p>
          <p class="text-center er-text mb-0" style="height: 3rem;"></p>
          <p class="mb-0"><span class="num-seven pr-2 py-2">+7</span><input type="tel" class="ipoteka-text ipoteka-text-1 py-2 pl-5" name="tel-ip" placeholder="Телефон"></p>
          <p class="text-center er-tel-text mb-0" style="height: 3rem;"></p>
        </div>
        <div class="d-flex justify-content-center mt-sm-5"><button class="btn btn-success btn-ipoteka btn-ipoteka-1">Далее</button></div>
      </form>
    </div>
    <div class="col-10 col-sm-6 d-flex flex-column mt-3 mt-sm-0">
      <div>
        <a href="#"><img class="" src="{% static 'img/ipoteka.png' %}" alt="ipteka_img" style="width: 100%; height: 13rem; object-fit: contain;"></a>
      </div>
      <div class="mt-2">
        <a href="#"><img src="{% static 'img/ipoteka1.png' %}" alt="img" style="width: 100%; height: 13rem; object-fit: contain;"></a>
      </div>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-11 col-sm-12 d-flex justify-content-between">
      <h2 id="building" class="gray font-weight-bold mb-3 mt-3">Ход строительства
        {% if object.buid_video %}<span id="video" class="ml-3">
          <a href="{{ object.buid_video }}" target="_blank"><img src="{% static 'img/live.png' %}" alt="live" style="height: 1.2rem;"></a>
        </span>
        {% endif %}
      </h2>
      <select class="mt-3" name="num_dom" id="select_num_dom" action="{% url 'property_detail' object.city.city_slug object.pk object.slug %}">
        {% for i in object.buildings_set.all %}
          <option value="{{ i.num_dom }}">{{ i.num_dom }}</option>
        {% endfor %}
      </select>
    </div>
  </div>
  <div class="res_dom">
    <div class="row">
      {% if not dom %}
        <div class="col-11 col-sm-12">
          <div class="d-flex justify-content-between">
            <p class="mb-0 gray">{{ object.buildings_set.first.start_date }}</p>
            <p class="mb-0 gray">{{ object.buildings_set.first.send_keys|date:"Y" }}</p>
          </div>
          <p><input class="sl4" data-slider-id="sl4Slider" type="text" data-slider-min="{{ object.buildings_set.first.start_date }}" data-slider-max="{{ object.buildings_set.first.send_keys|date:'Y' }}" data-slider-step="1" data-slider-value="{% now 'Y' %}"></p>
          <div class="sl d-flex justify-content-between">
            <p class="mb-0 gray">Начало строительства</p>
            <p class="mb-0 gray">Выдача ключей</p>
          </div>
        </div>
        {% if object.buildings_set.first.build_months.all %}
        <div class="col-12 d-flex justify-content-end mt-4">
          <p class="text-right"><select name="select_year" id="select_month">
            {% for item in build_year %}
            <option value="{{ item }}">{{ item }}</option>
            {% endfor %}
          </select></p>
        </div>
        {% for item in object.buildings_set.first.build_months.all|slice:":3" %}
        <div class="col-6 col-sm-4 col-lg-3">
          <div class="card">
            <a role="button" href="#" data-target="#modal_{{item.id}}" data-toggle="modal">
              <img class="card-img-top build-img" src="/media/{{ item.build_photos.first.build_img }}" alt="img" style="height: 10rem; object-fit:cover">
            </a>
            <div class="card-body">
              <h5 class="card-title gray">{{ item.build_month }}</h5>
              <p class="text-muted">фото: {{ item.build_photos.all|slice:":4"|length }} шт</p>
            </div>
          </div>
        </div>
        {% endfor %}
        {% else %}
          <p>Фотографии будут предоставлены по запросу</p>
        {% endif %}
        <h2 class="col-11 col-sm-12 gray mb-3 mt-3">Характеристика дома</h2>
        <div class="col-6 col-sm-4 mb-3">
          <p class="d-flex justify-content-between gray"><span>Класс недвижимости</span><span>{{ object.buildings_set.first.property_class }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Материал стен</span><span>{{ object.buildings_set.first.wall }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Тип отделки</span><span>{{ object.buildings_set.first.decoration }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Свободная планировка</span><span>{{ object.buildings_set.first.free_planning }}</span></p>
        </div>
        <div class="col-6 col-sm-4 mb-3">
          <p class="d-flex justify-content-between gray"><span>Количество этажей</span><span>{{ object.buildings_set.first.floors }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Количество квартир</span><span>{{ object.buildings_set.first.q_flats }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Жилая площадь</span><span>{{ object.buildings_set.first.living_sq|price }} м2</span></p>
          <p class="d-flex justify-content-between gray"><span>Высота потолков</span><span>{{ object.buildings_set.first.ceil_height }} м</span></p>
        </div>
        <div class="col-12 d-flex flex-wrap">
          <div class="col-12 col-sm-3 raspodazha">
            <p class="gray" style="margin-top: 5rem;">Распроданность</p>
          </div>
          <div class="col-6 col-sm-3 col-md-2 d-flex flex-column align-items-center">
            <p class="gray mb-2 font-weight-bold">Квартиры</p>
            {% if object.buildings_set.first.sales_flats %}
              <svg class="chart" width="100" height="100" viewBox="0 0 50 50">
                <circle class="unit" r="15.9" cx="50%" cy="50%" style="fill: none; stroke-width: 0.3rem; stroke: #55B50C; stroke-dasharray: {{ object.buildings_set.first.sales_flats|split:'%'|first }} 100"></circle>
              </svg>
              <p class="unit-value">{{ object.buildings_set.first.sales_flats }}</p>
            {% else %}
              <p class="text-center mt-5">&mdash;</p>
            {% endif %}
          </div>
          <div class="col-6 col-sm-3 d-flex flex-column align-items-center">
            <p class="gray mb-2 font-weight-bold">Нежилые помещения</p>
            {% if bject.buildings_set.first.sales_not_living %}
              <svg class="chart" width="100" height="100" viewBox="0 0 50 50">
                <circle class="unit" r="15.9" cx="50%" cy="50%" style="fill: none; stroke-width: 0.3rem; stroke: #55B50C; stroke-dasharray: {{ object.buildings_set.first.sales_not_living|split:'%'|first }} 100"></circle>
              </svg>
              <p class="unit-value">{{ object.buildings_set.first.sales_not_living }}</p>
            {% else %}
              <p class="text-center mt-5">&mdash;</p>
            {% endif %}
          </div>
          <div class="col-6 col-sm-3 col-md-2 d-flex flex-column align-items-center">
            <p class="gray mb-2 font-weight-bold">Машиноместа</p>
            {% if object.buildings_set.first.sales_parking %}
              <svg class="chart" width="100" height="100" viewBox="0 0 50 50">
                <circle class="unit" r="15.9" cx="50%" cy="50%" style="fill: none; stroke-width: 0.3rem; stroke: #55B50C; stroke-dasharray: {{ object.buildings_set.first.sales_parking|split:'%'|first }} 100"></circle>
              </svg>
              <p class="unit-value">{{ object.buildings_set.first.sales_parking }}</p>
            {% else %}
              <p class="text-center mt-5">&mdash;</p>
            {% endif %}
          </div>
        </div>
        <div class="col-11 col-sm-12" style="margin: auto;">
          <h2 id="documents" class="gray mb-3 mt-4">Документация</h2>
          {% if object.buildings_set.first.documents.all|slice:":2" %}
            {% for doc in object.buildings_set.first.documents.all|slice:":2" %}
            <a href="{{ doc.doc_link }}" class="d-flex justify-content-between gray mb-2">
              <p style="width: 75%;">{{ doc.doc_name }}</p>
              <p>{{ doc.doc_date|date:"d E Y" }}</p>
            </a>
            {% endfor %}
            <button class="btn btn-outline-secondary gray mb-2 pl-4 but-gray" data-toggle="modal" data-target="#m_{{ object.id }}">Подробнее
              <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.8125 6.375L8.5 11.6875L3.1875 6.375" stroke="#8D8D8D" stroke-width="1.0625" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <p class="gray small mb-3">*Источник наш.дом.рф, {{  object.buildings_set.first.main_contractor}}</p>
          {% else %}
            <p>Документы будут предоставлены по запросу</p>
          {% endif %}
        </div>
      {% else %}
        <div class="modal" id="m1_{{object.id}}" tabindex="-1" role="dialog">
          <div class="modal_add_info modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5>Документация</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <a href="{{ building.pr_decl_link }}" class="d-flex justify-content-between gray mb-2">
                  <p>Проектная декларация</p>
                  <p>№{{ building.pr_declaration }}</p>
                </a>
                {% for doc in building.documents.all %}
                  <a href="{{ doc.doc_link }}" class="d-flex justify-content-between gray mb-2">
                    <p style="width: 70%;">{{ doc.doc_name }}</p>
                    <p>{{ doc.doc_date|date:"d E Y" }}</p>
                  </a>
                {% endfor %}  
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="d-flex justify-content-between">
            <p class="mb-0 gray">{{ building.start_date }}</p>
            <p class="mb-0 gray">{{ building.send_keys|date:"Y" }}</p>
          </div>
          <p><input class="sl4" data-slider-id="sl5Slider" type="text" data-slider-min="{{ building.start_date }}" data-slider-max="{{ building.send_keys|date:'Y' }}" data-slider-step="1" data-slider-value="{% now 'Y' %}"></p>
          <div class="sl d-flex justify-content-between">
            <p class="mb-0 gray">Начало строительства</p>
            <p class="mb-0 gray">Выдача ключей</p>
          </div>
        </div>
        {% if building.build_months.all %}
        <div class="col-11 col-sm-12 d-flex justify-content-end mt-4">
          <p class="text-right"><select name="select_year" id="select_month">
            {% for item in build_year %}
            <option value="{{ item }}">{{ item }}</option>
            {% endfor %}
          </select></p>
        </div>
        {% for item in building.build_months.all|slice:":3" %}
        <div class="modal" id="modal_1_{{item.id}}" tabindex="-1" role="dialog">
          <div class="modal-photos modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5>{{ item.build_month }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div id="carouselControls_1_{{item.id}}" class="carousel slide" data-ride="carousel" data-interval="false">
                  <div class="carousel-inner build-photo" style="height: 30rem;">
                    <div class="carousel-item active">
                      <img class="d-block w-100 build-photo" src="/media/{{ item.build_photos.first.build_img }}" alt="img" style="height: 30rem; object-fit: cover;">
                    </div>
                    {% for img in item.build_photos.all|slice:"1:4" %}
                    <div class="carousel-item">
                      <img class="d-block w-100 build-photo" src="/media/{{ img.build_img }}" alt="img" style="height: 30rem; object-fit: cover;">
                    </div>
                    {% endfor %}
                    <a class="carousel-control-prev" href="#carouselControls_1_{{item.id}}" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselControls_1_{{item.id}}" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-6 col-sm-4 col-lg-3">
          <div class="card">
            <a role="button" href="#" data-target="#modal_1_{{item.id}}" data-toggle="modal">
              <img class="card-img-top build-img" src="/media/{{ item.build_photos.first.build_img }}" alt="img" style="height: 10rem; object-fit:cover">
            </a>
            <div class="card-body">
              <h5 class="card-title gray">{{ item.build_month }}</h5>
              <p class="text-muted">фото: {{ item.build_photos.all|slice:":4"|length }} шт</p>
            </div>
          </div>
        </div>
        {% endfor %}
        {% else %}
          <p>Фотографии будут предоставлены по запросу</p>
        {% endif %}
        <h2 class="col-11 col-sm-12 gray mb-3 mt-3">Характеристика дома</h2>
        <div class="col-5 col-sm-4 mb-3">
          <p class="d-flex justify-content-between gray"><span>Класс недвижимости</span><span>{{ building.property_class }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Материал стен</span><span>{{ building.wall }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Тип отделки</span><span>{{ building.decoration }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Свободная планировка</span><span>{{ building.free_planning }}</span></p>
        </div>
        <div class="col-5 col-sm-4 mb-3">
          <p class="d-flex justify-content-between gray"><span>Количество этажей</span><span>{{ building.floors }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Количество квартир</span><span>{{ building.q_flats }}</span></p>
          <p class="d-flex justify-content-between gray"><span>Жилая площадь</span><span>{{ building.living_sq|price }} м2</span></p>
          <p class="d-flex justify-content-between gray"><span>Высота потолков</span><span>{{ building.ceil_height }} м</span></p>
        </div>
        <div class="col-11 col-sm-12 d-flex">
          <div class="col-4 col-sm-3">
            <p class="gray" style="margin-top: 5rem;">Распроданность</p>
          </div>
          <div class="col-5 col-sm-3 col-md-2 d-flex flex-column align-items-center">
            <p class="gray mb-2 font-weight-bold">Квартиры</p>
            {% if building.sales_flats %}
              <svg class="chart" width="100" height="100" viewBox="0 0 50 50">
                <circle class="unit" r="15.9" cx="50%" cy="50%" style="fill: none; stroke-width: 0.3rem; stroke: #55B50C; stroke-dasharray: {{ building.sales_flats|split:'%'|first }} 100"></circle>
              </svg>
              <p class="unit-value">{{ building.sales_flats }}</p>
            {% else %}
              <p class="text-center mt-5">&mdash;</p>
            {% endif %}
          </div>
          <div class="col-5 col-sm-3 d-flex flex-column align-items-center">
            <p class="gray mb-2 font-weight-bold">Нежилые помещения</p>
            {% if building.sales_not_living %}
              <svg class="chart" width="100" height="100" viewBox="0 0 50 50">
                <circle class="unit" r="15.9" cx="50%" cy="50%" style="fill: none; stroke-width: 0.3rem; stroke: #55B50C; stroke-dasharray: {{ building.sales_not_living|split:'%'|first }} 100"></circle>
              </svg>
              <p class="unit-value">{{ building.sales_not_living }}</p>
            {% else %}
              <p class="text-center mt-5">&mdash;</p>
            {% endif %}
          </div>
          <div class="col-5 col-sm-3 col-md-2 d-flex flex-column align-items-center">
            <p class="gray mb-2 font-weight-bold">Машиноместа</p>
            {% if building.sales_parking %}
              <svg class="chart" width="100" height="100" viewBox="0 0 50 50">
                <circle class="unit" r="15.9" cx="50%" cy="50%" style="fill: none; stroke-width: 0.3rem; stroke: #55B50C; stroke-dasharray: {{ building.sales_parking|split:'%'|first }} 100"></circle>
              </svg>
              <p class="unit-value">{{ building.sales_parking }}</p>
            {% else %}
              <p class="text-center mt-5">&mdash;</p>
            {% endif %}
          </div>
        </div>
        <div class="col-11 col-sm-12">
          <h2 id="documents" class="gray mb-3 mt-4">Документация</h2>
            {% if building.documents.all|slice:":2" %}
              {% for doc in building.documents.all|slice:":2" %}
              <a href="{{ doc.doc_link }}" class="d-flex justify-content-between gray mb-2">
                <p style="width: 75%;">{{ doc.doc_name }}</p>
                <p>{{ doc.doc_date|date:"d E Y" }}</p>
              </a>
              {% endfor %}
              <button class="btn btn-outline-secondary gray mb-2 pl-4 but-gray" data-toggle="modal" data-target="#m1_{{ object.id }}">Подробнее
                <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.8125 6.375L8.5 11.6875L3.1875 6.375" stroke="#8D8D8D" stroke-width="1.0625" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <p class="gray small mb-3">*Источник наш.дом.рф, {{ object.buildings_set.first.main_contractor }}</p>
            {% else %}
            <p>Документы будут предоставлены по запросу</p>
            {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
  <h2 class="gray mb-3 mt-3">Медиа</h2>
  <div class="row" style="height: 13.5rem;">
    <div class="col-7 col-sm-8 col-md-9" style="border-radius: 10px; height: 13.5rem;">
      {% if build_news %}
        <a href="{% url 'news_detail' build_news.pk %}" style="text-decoration: none;">
          <img src="/media/{{ buld_news.img_news.first.img }}" alt="news_img"  style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
          <div class="d-flex flex-column build_news">
            <p class="gray mb-3">{{ build_news.published|date:"d m Y" }}</p>
            <h5 class="gray mb-3">{{ build_news.title }}</h5>
            {{ build_news.description|truncatewords:20|safe }}
          </div>
        </a>
      {% else %}
        <a href="{% url 'news_detail' news.pk %}" style="text-decoration: none;">
          <img src="/media/{{ news.img_news.first.img }}" alt="news_img" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
          <div class="d-flex flex-column build_news">
            <p class="mb-3">{{ news.published|date:"d E Y" }}</p>
            <h3 class="mb-3">{{ news.title }}</h3>
            {{ news.description|truncatewords:20|safe }}
          </div>
        </a>
      {% endif %}
    </div>
    <div class="col-4 col-sm-4 col-md-3">
      <img src="{% static 'img/telega.png' %}" alt="telegram_img" style="height: 13.5rem; width: 13.5rem; border-radius: 10px;">
      <div class="d-flex flex-column telega-text">
        <h5 class="mb-4 text-center" style="width: 85%; margin: auto">Подписывайтесь на наш Телеграм и будьте в курсе</h5>
        <a href="https://t.me/bashni111" target="_blank" class="btn btn-success" role="button" style="border-radius: 10px; width: 85%; margin: auto;">Подписаться</a>
      </div>
    </div>
  </div>
  {% if object.youtubechannel_set.first %}
    <div class="row mt-5">
      <div class="slider slider-2">
        <div class="slider__container">
          <div class="slider__wrapper">
            {% if object.youtubechannel_set.all|length == 1 %}
            <div class="slider__items" style="justify-content: center;">
            {% else %}
            <div class="slider__items">
            {% endif %}
              {% for item in object.youtubechannel_set.all %}
                <div class="col-6 col-sm-4 col-lg-3 slider__item">
                  <iframe class="frame_video" src="{{ item.video_url }}" frameborder="0" allowfullscreen style="width: 100%; height: 12rem;"></iframe>
                </div>
              {% endfor %}
            </div>
          </div>
          <a href="#" class="slider__control" data-slide="prev"></a>
          <a href="#" class="slider__control" data-slide="next"></a>
        </div>
      </div>
    </div>
  {% endif %}
  {% if similar_obj %}
  <h2 class="gray mb-3 mt-5">Похожие проекты рядом</h2>
  <div class="row mx-sm-3">
    <div class="slider slider-1">
      <div class="slider__container">
        <div class="slider__wrapper">
          {% if similar_obj|length == 1 %}
          <div class="slider__items" style="justify-content: center;">
          {% else %}
          <div class="slider__items">
          {% endif %}
            {% for item in similar_obj %}
              <div class="col-6 col-sm-4 col-lg-3 slider__item">
                <div class="card" style="border: none;">
                  <a href="{% url 'property_detail' item.city.city_slug item.pk item.slug %}">
                      <img class="card-img-top" src="/media/{{ item.buildings_set.first.small_img }}" alt="img" style="height: 10rem; border-radius: 0.6rem;">
                  </a>
                  <p class="heart">
                      <span>
                          {% if request.user.is_authenticated %}
                              <i id="{{ item.id }}_zhk" data-url="{{ request.path }}" class="{% if item.id in fav_zhk %}fa fa-heart{% else %}fa fa-heart-o{% endif %}" aria-hidden="true" style="color: #55B50C;"></i>
                          {% else %}
                              <i id="{{ item.id }}" data-url="{{ request.path }}" class="{% if item.id in request.session.fav_zhk %}fa fa-heart{% else %}fa fa-heart-o{% endif %}" aria-hidden="true" style="color: #55B50C;"></i>
                          {% endif %}
                      </span>
                  </p>
                   <div class="card-body">
                       <p class="badge badge-pill badge-secondary">{{ item.buildings_set.first.get_build_stage_display }}</p>
                       <h4 class="card-title"><a href="{% url 'property_detail' item.city.city_slug item.pk item.slug %}" style="color: #55B50C;">{{ item.name|truncatewords:20 }}</a></h4>
                       <p class="small">Срок сдачи: {{ item.buildings_set.first.operation_term }}</p>
                       <p>Стоимость 1 м2: {% if item.buildings_set.first.middle_price %}{{ item.buildings_set.first.middle_price|price }} &#8381{% else %} &mdash;{% endif %}</p>
                   </div>
               </div>
              </div>
            {% endfor %}
          </div>
        </div>
        <a href="#" class="slider__control" data-slide="prev"></a>
        <a href="#" class="slider__control" data-slide="next"></a>
      </div>
    </div>
  </div> 
  {% endif %} 
</div>
{% endblock content %}

{% block js %}
  <script src="{% static 'js/jquery-3.6.0-min.js' %}"></script>
  <script src="{% static 'js/bootstrap.bundle.js' %}"></script>
  <script src="https://use.fontawesome.com/aeedf3f379.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"></script>
  <script src="{% static 'js/chief-slider.js' %}"></script>
  <script src="{% static 'js/slider.js' %}"></script>
  <script src="{% static 'js/script.js' %}"></script>
  <script src="https://api-maps.yandex.ru/2.1/?apikey=8ec00dc7-a9a0-4674-88c1-99d039d8ceea&lang=ru_RU"></script>
  <script src="{% static 'js/yandex.js' %}"></script>
{% endblock %}